MapViewer=function(){_this=this,_this.ViewModel=null,_this.FindLatestTimer=null,_this.IsBuilding=!1,_this.Hash=null,_this.LightsInterval=null,_this.MapSelector="#CombatViewModel",_this.FindLatest=function(){var i=localStorage.getItem("MAPVIEW-Hash");null!==i&&_this.Hash!=i&&_this.BuildMap(i)},_this.BuildMap=function(i){if(!_this.IsBuilding){_this.IsBuilding=!0;try{var t=JSON.parse(localStorage.getItem("MAPVIEW-ViewModel"));if(t)if(_this.ViewModel.Load(t),WORKSPACE.GridMap.setZoom(t.GridZoom||1),WORKSPACE.GridMap.panTo(t.GridCenter||[0,0]),WORKSPACE.ViewModels.CombatViewModel.ShowDarkness())_this.LightsInterval=setInterval(WORKSPACE.Helpers.DrawLights,50);else{clearInterval(_this.LightsInterval);var e=$("#grid-light"),s=e[0].getContext("2d");s.clearRect(0,0,e[0].width,e[0].height)}}catch(i){console.log(i)}_this.Hash=i,_this.IsBuilding=!1}},_this.Init=function(){WORKSPACE.ViewModels.CombatViewModel=_this.ViewModel=new CombatViewModel,ko.applyBindings(_this.ViewModel,$(_this.MapSelector)[0]),_this.FindLatestTimer=setInterval(_this.FindLatest,25)}},$(function(){var i=new MapViewer;WORKSPACE.Shim(),WORKSPACE.IsLoaded=!0,i.Init()});