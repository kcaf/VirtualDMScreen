MapViewer=function(){_this=this,_this.ViewModel=null,_this.FindLatestTimer=null,_this.IsBuilding=!1,_this.Hash=null,_this.HashCompare=null,_this.MapSelector="#CombatViewModel",_this.FindLatest=function(){HashCompare=localStorage.getItem("MAPVIEW-Hash"),null!==HashCompare&&_this.Hash!=HashCompare&&_this.BuildMap(HashCompare)},_this.BuildMap=function(i){if(!_this.IsBuilding){_this.IsBuilding=!0;try{var e=JSON.parse(localStorage.getItem("MAPVIEW-ViewModel"));if(e){if(_this.ViewModel.Load(e),WORKSPACE.GridMap.setZoom(e.GridZoom||1),WORKSPACE.GridMap.panTo(e.GridCenter||[0,0]),!e.ShowDarkness){var t=$("#grid-light")[0],s=t.getContext("2d");s.clearRect(0,0,t.width,t.height)}if(e.ShowFog)WORKSPACE.Helpers.DrawFog();else{var t=$("#grid-fog")[0],s=t.getContext("2d");s.clearRect(0,0,t.width,t.height)}}}catch(i){console.log(i)}_this.Hash=i,_this.IsBuilding=!1}},_this.Init=function(){WORKSPACE.ViewModels.CombatViewModel=_this.ViewModel=new CombatViewModel,ko.applyBindings(_this.ViewModel,$(_this.MapSelector)[0]),_this.FindLatestTimer=setInterval(_this.FindLatest,25)}},$(function(){var i=new MapViewer;WORKSPACE.Shim(),WORKSPACE.IsLoaded=!0,i.Init()});