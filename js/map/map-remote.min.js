MapViewer=function(){_this=this,_this.ViewModel=null,_this.IsBuilding=!1,_this.Hash=null,_this.HashCompare=null,_this.MapSelector="#CombatViewModel",_this.Peer=null,_this.Connect=function(i){var e=_this.Peer.connect(i);e.on("open",function(){$("#connect").dialog("close"),e.on("data",function(i){_this.BuildMap(i)}),e.on("close",function(){$("#connect").dialog("open")})}),setTimeout(function(){e.open||$("#connect").dialog("open")},1e4)},_this.BuildMap=function(i){if(!_this.IsBuilding){_this.IsBuilding=!0;try{var e=JSON.parse(i);if(e){if(_this.ViewModel.Load(e),WORKSPACE.GridMap.setZoom(e.GridZoom||1),WORKSPACE.GridMap.panTo(e.GridCenter||[0,0]),!e.ShowDarkness){var o=$("#grid-light")[0],t=o.getContext("2d");t.clearRect(0,0,o.width,o.height)}if(e.ShowFog)WORKSPACE.Helpers.DrawFog();else{var o=$("#grid-fog")[0],t=o.getContext("2d");t.clearRect(0,0,o.width,o.height)}}}catch(i){console.log(i)}_this.IsBuilding=!1}},_this.Init=function(){_this.Dialog=$("#connect").dialog({autoOpen:!1,modal:!0,buttons:{Connect:function(){_this.Connect($("#connid").val()),$(this).dialog("close")}},position:{my:"center",at:"center",of:window}}),WORKSPACE.ViewModels.CombatViewModel=_this.ViewModel=new CombatViewModel,ko.applyBindings(_this.ViewModel,$(_this.MapSelector)[0]),_this.Peer=new Peer(null,WORKSPACE.PeerOptions),_this.Peer.on("open",function(i){_this.Dialog.dialog("open")})}},$(function(){WORKSPACE.MAP=new MapViewer,WORKSPACE.Shim(),WORKSPACE.IsLoaded=!0,WORKSPACE.MAP.Init()});