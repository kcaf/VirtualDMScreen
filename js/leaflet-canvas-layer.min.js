"undefined"!=typeof L&&(L.CanvasLayer=L.Class.extend({includes:[L.Mixin.Events,L.Mixin.TileLoader],options:{minZoom:0,maxZoom:28,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:L.Browser.mobile,updateWhenIdle:L.Browser.mobile,tileLoader:!1},initialize:function(t){t=t||{},this.render=this.render.bind(this),L.Util.setOptions(this,t),this._canvas=this._createCanvas(),this._backCanvas=this._createCanvas(),this._ctx=this._canvas.getContext("2d"),this.currentAnimationFrame=-1,this.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)},this.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||function(t){clearTimeout(t)}},_createCanvas:function(){var t;t=document.createElement("canvas"),t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.pointerEvents="none",t.style.zIndex=this.options.zIndex||0;var i="leaflet-tile-container leaflet-zoom-animated";return t.setAttribute("class",i),t},onAdd:function(t){this._map=t;var i=this._map._panes.tilePane,e=L.DomUtil.create("div","leaflet-layer");e.appendChild(this._canvas),e.appendChild(this._backCanvas),this._backCanvas.style.display="none",i.appendChild(e),this._container=e,t.dragging.enabled()&&t.dragging._draggable.on("predrag",function(){var i=t.dragging._draggable;L.DomUtil.setPosition(this._canvas,{x:-i._newPos.x,y:-i._newPos.y})},this),t.on({viewreset:this._reset},this),t.on("move",this.redraw,this),t.on("resize",this._reset,this),t.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.tileLoader&&this._initTileLoader(),this._reset()},_animateZoom:function(t){this._animating||(this._animating=!0);var i=this._backCanvas;i.width=this._canvas.width,i.height=this._canvas.height;this._canvas._leaflet_pos||{x:0,y:0};i.getContext("2d").drawImage(this._canvas,0,0),this._canvas.style.display="none",i.style.display="block";var e=this._map,n=(e.getZoomScale(t.zoom),e._latLngToNewLayerPoint(e.getCenter(),t.zoom,t.center)),a=e._latLngToNewLayerPoint(t.center,t.zoom,t.center),s={x:n.x-a.x,y:n.y-a.y},o=i,r=L.DomUtil.TRANSFORM;o.style[r]=L.DomUtil.getTranslateString(s)+" scale("+t.scale+") "},_endZoomAnim:function(){this._animating=!1,this._canvas.style.display="block",this._backCanvas.style.display="none"},getCanvas:function(){return this._canvas},getAttribution:function(){return this.options.attribution},draw:function(){return this._reset()},onRemove:function(t){this._container.parentNode.removeChild(this._container),t.off({viewreset:this._reset,move:this._render,resize:this._reset,zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this)},addTo:function(t){return t.addLayer(this),this},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){this._canvas.style.zIndex=t},bringToFront:function(){return this},bringToBack:function(){return this},_reset:function(){var t=this._map.getSize();this._canvas.width=t.x,this._canvas.height=t.y;var i=L.DomUtil.getPosition(this._map.getPanes().mapPane);i&&L.DomUtil.setPosition(this._canvas,{x:-i.x,y:-i.y}),this.onResize(),this._render()},_updateOpacity:function(){},_render:function(){this.currentAnimationFrame>=0&&this.cancelAnimationFrame.call(window,this.currentAnimationFrame),this.currentAnimationFrame=this.requestAnimationFrame.call(window,this.render)},redraw:function(t){var i=L.DomUtil.getPosition(this._map.getPanes().mapPane);i&&L.DomUtil.setPosition(this._canvas,{x:-i.x,y:-i.y}),t?this.render():this._render()},onResize:function(){},render:function(){throw new Error("render function should be implemented")}}));