<div class="combatviewmodel-inc"> 
	<ul class="noselect">
		<li><a href="#InitiativeTab" data-bind="click: SetActiveTab.bind($data, 0)">Initiative</a></li>
		<li><a href="#GridTab" data-bind="click: SetActiveTab.bind($data, 1)">Battlemap</a></li>
		<li><a href="#GridSettingsTab" data-bind="click: SetActiveTab.bind($data, 2)">Settings</a></li>
	</ul>
	<div id="InitiativeTab">
		<div class="grid filters">
			<table class="combat ko-grid" data-bind="visible: CombatantList().length > 0">
				<thead>
					<tr>
						<th class="combat-token"></th>
						<th class="combat-name">Name</th>
						<th class="combat-levelcr">Level/CR</th>
						<th class="combat-ac">AC</th>
						<th class="combat-initiative">Initiative</th>
						<th class="combat-hp">HP</th>
						<th class="combat-del" />
					</tr>
				</thead>
				<tbody data-bind="foreach: OrderedCombatantList">
					<tr data-bind="attr: {class: RowClass}">
						<td><img class="combat-token" data-bind="attr: {src: Token}, click: PickToken" /></td>
						<td class="combat-name">
							<i class="noselect npc-view fa fa-external-link" 
								data-bind="visible: ModelType() == 'NPC', 
									click: WORKSPACE.Helpers.ViewNPC.bind($data, $data.Id())"></i>
							<input class="combat-name required" data-bind="css: {npc: ModelType() == 'NPC'}, value: Name" />
						</td>
						<td><input class="combat-levelcr" data-bind="textInput: LevelAndCR" /></td>
						<td><input class="combat-ac" data-bind="textInput: ACBasic, attr: {title: AC}" /></td>
						<td><input class="combat-initiative" data-bind="value: Initiative" /></td>
						<td><input class="combat-hp" data-bind="value: CalculateHP, attr: {title: MaxHPText}" /></td>
						<td class="combat-del noselect">
							<i title="Remove" class="combat-del fa fa-times" 
								data-bind="click: $root.RemoveCombatant"></i>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<button class="ui-button extra-margins ui-corner-all ui-widget" data-bind="click: AddCombatant">Add Combatant</button>
		<table class="ko-grid npc-view combat-difficulty" data-bind="visible: CombatantList().length > 0">
			<tbody>
				<tr>
					<th class="difficulty">Difficulty</th>
					<td class="difficulty" data-bind="text: Difficulty"></td>
				</tr>
			</tbody>
		</table>
	</div>
	<div id="GridTab">
		<svg class="defs-only">
			<filter id="DeadToken" color-interpolation-filters="sRGB"
				  x="0" y="0" height="100%" width="100%">
				<feColorMatrix type="matrix"
			        values="0.50 0 0 0 0.30 
			                0.50 0 0 0 0.00  
			                0.50 0 0 0 0.00 
			                0    0 0 1 0" />
			</filter>
		</svg>
		<div class="grid-container noselect"><!-- data-bind="style: {backgroundImage: GridBackground}">-->
			<div id="grid-map">
			</div>
			<div id="grid-lines" data-bind="css: {'show': ShowGridLines, 'alt-color': AltGridColor}"></div>
			<!-- data-bind="css: {'grid-lines': ShowGridLines, 'alt-color': AltGridColor}, foreach: CombatantList()">
				<div data-bind="attr: {class: TokenClass, title: Name}, 
					style: {zIndex: ZIndex, left: PositionLeft, top: PositionTop}, 
					event: {mousemove: MouseMove, mousedown: MouseDown, mouseup: MouseUp, dblclick: ViewCombatant}">
				</div>
			</div>-->
			<canvas id="grid-canvas"></canvas>
		</div>
	</div>
	<div id="GridSettingsTab">
		<div class="filters">
			<div class="gridsettings-add">
				<input type="text" name="grid-mapslide-add" data-bind="textInput: MapToAdd" />
				<button class="ui-button ui-corner-all ui-widget" data-bind="click: AddMap">Add Map</button>
			</div>
			<div class="gridsettings-outline">
				<label for="grid-outline">Token Outline</label>
				<input type="checkbox" name="grid-outline" data-bind="checked: ShowOutlines" />
			</div>
			<div class="gridsettings-lines">
				<label for="grid-lines">Show Grid</label>
				<input type="checkbox" name="grid-lines" data-bind="checked: ShowGridLines" />
			</div>
			<div class="gridsettings-color">
				<label for="grid-color">Alt Color</label>
				<input type="checkbox" name="grid-color" data-bind="checked: AltGridColor" />
			</div>
			<div class="gridsettings-scale">
				<label>Scale:</label> <span data-bind="text: TokenScale"></span>
				<div id="token-scale"></div>
			</div>
			<div class="gridsettings-scale">
				<label for="grid-transmit">Map Viewer</label>
				<input type="checkbox" name="grid-transmit" data-bind="checked: TransmitMap" />
			</div>
			<div class="gridsettings-buttons">
				<button class="ui-button ui-corner-all ui-widget" data-bind="click: ResetTokens">Reset Tokens</button>
			</div>
		</div>
		<!--<div id="grid-mapslides"
			<ul id="map-slide-list" data-bind="foreach: MapSlides">
				<li class="map-slide lslide">
					<a href="javascript:void(0)"><img data-bind="attr: {src: Source}, click: $parent.LoadMap" /></a>
					<i class="remove-map fa fa-times" data-bind="click: $parent.RemoveMap"></i>
				</li>
			</ul>
		</div>-->
		<div id="grid-mapslides" data-bind="foreach: MapSlides">
			<div class="grid-map-thumb">
				<img data-bind="attr: {src: Source}, click: $parent.LoadMap" />
				<i class="remove-map fa fa-times" data-bind="click: $parent.RemoveMap"></i>
			</div>
		</div>
	</div>
</div>